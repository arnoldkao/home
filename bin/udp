#!/usr/bin/python

# A script that starts up, binds to a UDP port (for sending only), then accepts
# filenames via stdin to read and transmit as UDP packets to the specified UDP
# destination socket.

import sys
import os
import socket

#serverIP=socket.gethostname()
serverIP='localhost'
sock = None
dest = None

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print "usage:", sys.argv[0], "<listening port> [<file>]"
        sys.exit(0)

    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.bind((serverIP, 0))

    destPort = int(sys.argv[1])
    dest = (serverIP, destPort)

    if len(sys.argv) == 3:
        if os.path.isfile(sys.argv[2]):
            with open (sys.argv[2], "r") as fileIn:
                data = fileIn.read()
                print "sending", sys.argv[2]
                sock.sendto(data, dest)
        else:
            print "invalid file: ", sys.argv[2]
    else:
        while True:
            line = sys.stdin.readline().strip()
            if os.path.isfile(line):
                with open (line, "r") as fileIn:
                    data = fileIn.read()
                    print "sending", line
                    sock.sendto(data, dest)
            else:
                print os.listdir(os.getcwd())

    sock.close()
